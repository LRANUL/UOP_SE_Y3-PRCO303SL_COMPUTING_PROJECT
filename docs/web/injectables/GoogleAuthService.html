<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>government-portal-web documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">government-portal-web documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">







<ol class="breadcrumb">
  <li>Injectables</li>
  <li>GoogleAuthService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/service/google-auth.service.ts</code>
        </p>

            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>Service Page contains mandatory methods for application running which are directly called by other components when required
Update with care, certains methods are used in more than in onr place. Updates can cause the application to halt processess.</p>
<p>Firebase Authentication, Firestore Management is controlled here.</p>

            </p>



            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#alertController">alertController</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#toastController">toastController</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#eCitizenData">eCitizenData</a>
                            </li>
                            <li>
                                <a href="#getEApplications">getEApplications</a>
                            </li>
                            <li>
                                <a href="#getESupportMessages">getESupportMessages</a>
                            </li>
                            <li>
                                <a href="#loginCitizen">loginCitizen</a>
                            </li>
                            <li>
                                <a href="#logoutCitizen">logoutCitizen</a>
                            </li>
                            <li>
                                <a href="#registerECitizen">registerECitizen</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#sendNICApplication">sendNICApplication</a>
                            </li>
                            <li>
                                <a href="#sendSupportMessage">sendSupportMessage</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(route: <a href="https://angular.io/api/router/Router" target="_blank">Router</a>, toastController: ToastController, gAuth: AngularFireAuth, firestore: AngularFirestore, alertController: AlertController)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="19" class="link-to-prism">src/app/service/google-auth.service.ts:19</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>route</td>
                                                  
                                                        <td>
                                                                        <code><a href="https://angular.io/api/router/Router" target="_blank" >Router</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>toastController</td>
                                                  
                                                        <td>
                                                                    <code>ToastController</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>gAuth</td>
                                                  
                                                        <td>
                                                                    <code>AngularFireAuth</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>firestore</td>
                                                  
                                                        <td>
                                                                    <code>AngularFirestore</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>alertController</td>
                                                  
                                                        <td>
                                                                    <code>AlertController</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="eCitizenData"></a>
                    <span class="name">
                        <b>
                            eCitizenData
                        </b>
                        <a href="#eCitizenData"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>eCitizenData()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="516"
                            class="link-to-prism">src/app/service/google-auth.service.ts:516</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Method used for fetching current active user data from firebase these include email, photo, name of the authenticated user
Used for displaying data at required functions</p>
</div>

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getEApplications"></a>
                    <span class="name">
                        <b>
                            getEApplications
                        </b>
                        <a href="#getEApplications"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getEApplications()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="423"
                            class="link-to-prism">src/app/service/google-auth.service.ts:423</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getESupportMessages"></a>
                    <span class="name">
                        <b>
                            getESupportMessages
                        </b>
                        <a href="#getESupportMessages"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getESupportMessages()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="413"
                            class="link-to-prism">src/app/service/google-auth.service.ts:413</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="loginCitizen"></a>
                    <span class="name">
                        <b>
                            loginCitizen
                        </b>
                        <a href="#loginCitizen"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>loginCitizen(value)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="435"
                            class="link-to-prism">src/app/service/google-auth.service.ts:435</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Method for logging in user to system</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>value</td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>Holds data coming from Login form and invokes for verfication before allowing access</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="logoutCitizen"></a>
                    <span class="name">
                        <b>
                            logoutCitizen
                        </b>
                        <a href="#logoutCitizen"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>logoutCitizen()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="481"
                            class="link-to-prism">src/app/service/google-auth.service.ts:481</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>On user command initiates Firebase signout, this method is accessible by all accounts for users, officers and administrators</p>
</div>

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="registerECitizen"></a>
                    <span class="name">
                        <b>
                            registerECitizen
                        </b>
                        <a href="#registerECitizen"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>registerECitizen(value)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="55"
                            class="link-to-prism">src/app/service/google-auth.service.ts:55</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Method for Registering user with the System</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>value</td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>Takes all inputs from Registration form</p>

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                        <b>Example :</b>
                        <div>
                            <pre class="line-numbers"><code class="language-html">doc.data()[&amp;#39;birthRegNo&amp;#39;] == value.birthRegNo &amp;amp;&amp;amp; doc.data()[&amp;#39;dateOfBirth&amp;#39;] == dateBirth &amp;amp;&amp;amp; doc.data()[&amp;#39;Full_Name&amp;#39;] == value.fullName.toUpperCase()</code></pre>
                        </div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="sendNICApplication"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Async</span>
                            sendNICApplication
                        </b>
                        <a href="#sendNICApplication"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>sendNICApplication(value, token)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="232"
                            class="link-to-prism">src/app/service/google-auth.service.ts:232</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Method reponsible for sending NIC applications via Government Portal
To prevent third party usage of Government Resources secondary validation takes place to validate entered data before submitting application
This restricts that only the personal account holder to apply / Any form of Joint/Enterprise/Partner accounts are available at this time</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>value</td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>This holds NIC application data send by registered user via forms available on the Account Portal</p>

                                    </td>
                                </tr>
                                <tr>
                                    <td>token</td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>{}</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="sendSupportMessage"></a>
                    <span class="name">
                        <b>
                            sendSupportMessage
                        </b>
                        <a href="#sendSupportMessage"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>sendSupportMessage(value, name)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="365"
                            class="link-to-prism">src/app/service/google-auth.service.ts:365</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Method reponsible for sending Support messages via Government Portal</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>value</td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                        <p>This holds Support message data send by registered user via forms available on the Account Portal</p>

                                    </td>
                                </tr>
                                <tr>
                                    <td>name</td>

                                    <td>
                                        No
                                    </td>


                                    <td>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>
            <section>
    
        <h3 id="inputs">
            Properties
        </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="alertController"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            alertController</b>
                            <a href="#alertController"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>AlertController</code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="25" class="link-to-prism">src/app/service/google-auth.service.ts:25</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="toastController"></a>
                        <span class="name">
                            <b>
                                <span class="modifier">Public</span>
                            toastController</b>
                            <a href="#toastController"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>ToastController</code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="22" class="link-to-prism">src/app/service/google-auth.service.ts:22</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable } from &quot;@angular/core&quot;;
import { AngularFireAuth } from &quot;@angular/fire/auth&quot;;
import * as firebase from &quot;firebase/app&quot;;
import { AngularFirestore } from &quot;@angular/fire/firestore&quot;;
import { AlertController, ToastController } from &quot;@ionic/angular&quot;;
import * as dateFormat from &quot;dateformat&quot;;
import { Router } from &quot;@angular/router&quot;;
import * as CryptoJS from &quot;crypto-js&quot;;

/**
 * Service Page contains mandatory methods for application running which are directly called by other components when required
 * Update with care, certains methods are used in more than in onr place. Updates can cause the application to halt processess.
 *
 * Firebase Authentication, Firestore Management is controlled here.
 */
@Injectable({
  providedIn: &quot;root&quot;,
})
export class GoogleAuthService {
  constructor(
    protected route: Router,
    public toastController: ToastController,
    protected gAuth: AngularFireAuth,
    protected firestore: AngularFirestore,
    public alertController: AlertController
  ) {
    // TESTED AUTH SYSTEMS
    /**
     * @example
     *  this.gAuth.authState.subscribe(user &#x3D;&gt; {
     *  if (user) {
     *    // User is signed in.
     *    console.log(&#x27;User is signed in&#x27;);
     *    }
     *  else {
     *    // No user is signed in.
     *    console.log(&#x27;User is NOT signed in&#x27;);
     *    }
     *  });
     *
     */
  }
  /**
   * Method for Registering user with the System
   * @param value Takes all inputs from Registration form
   * @param value.birthRegNo Holds the applicants Birth Certificate Registration Number
   * @param value.dateBirth Holds the applicants Date of Birth
   * @param value.fullName Holds the applicants Full Name
   * These 3 parameters are verfied before proceeding with the registration
   *
   * @example
   *  doc.data()[&#x27;birthRegNo&#x27;] &#x3D;&#x3D; value.birthRegNo &amp;&amp; doc.data()[&#x27;dateOfBirth&#x27;] &#x3D;&#x3D; dateBirth &amp;&amp; doc.data()[&#x27;Full_Name&#x27;] &#x3D;&#x3D; value.fullName.toUpperCase()
   *
   */
  registerECitizen(value) {
    return new Promise&lt;any&gt;(async (_resolve, _reject) &#x3D;&gt; {
      this.firestore
        .collection(&quot;BirthRegistrations&quot;)
        .doc(&quot;&quot; + value.birthRegNo + &quot;&quot;)
        .ref.get()
        .then(async (doc) &#x3D;&gt; {
          if (doc.exists) {
            /** Informs user an account already exists */
            if (doc.data()[&quot;Registered&quot;] &#x3D;&#x3D; true) {
              const alert &#x3D; await this.alertController.create({
                header: &quot;⚠ Registration Failed&quot;,
                subHeader: &quot;Already have an account with us&quot;,
                message:
                  &quot;Your registration has failed, as the entered details show that you have account with us. Please recover it using the web portal or contact one of our officers.&quot;,
                buttons: [&quot;Ok&quot;],
              });
              await alert.present();
            } else {
              let dateBirth &#x3D; dateFormat(value.dateOfBirth, &quot;mm/dd/yyyy&quot;);
              if (
                doc.data()[&quot;birthRegNo&quot;] &#x3D;&#x3D; value.birthRegNo &amp;&amp;
                doc.data()[&quot;gender&quot;] &#x3D;&#x3D; value.gender.toUpperCase() &amp;&amp;
                doc.data()[&quot;dateOfBirth&quot;] &#x3D;&#x3D; dateBirth &amp;&amp;
                doc.data()[&quot;Full_Name&quot;] &#x3D;&#x3D; value.fullName.toUpperCase()
              ) {
                return new Promise&lt;any&gt;(async (resolve, reject) &#x3D;&gt; {
                  this.gAuth
                    .createUserWithEmailAndPassword(value.email, value.password)
                    .then(
                      (res) &#x3D;&gt; resolve(res),
                      (err) &#x3D;&gt; reject(err)
                    );

                  this.gAuth.authState.subscribe(async (user) &#x3D;&gt; {
                    if (user) {
                      user.updateProfile({
                        displayName: value.GovernmentID,
                        photoURL: value.downloadURL,
                      });
                    }
                    // Access PIN for Users via Portal Card
                    let Access_PIN &#x3D; Math.floor(
                      Math.random() * 9000000 + 1000000
                    );
                    // https://code.google.com/archive/p/crypto-js/

                    let Access_Key &#x3D; CryptoJS.AES.encrypt(
                      value.GovernmentID,
                      value.bioData
                    ).toString();
                    /**
                     * Data gets stored on Firebase for references
                     * */
                    this.firestore
                      .collection(&quot;eCitizens&quot;)
                      .doc(value.GovernmentID)
                      .set({
                        Access_PIN: Access_PIN,
                        Access_Key: Access_Key,
                        Full_Name: value.fullName.toUpperCase(),
                        Gender: value.gender.toUpperCase(),
                        Date_Of_Birth: dateBirth,
                        Place_Of_Birth: value.placeOfBirth.toUpperCase(),
                        Registar_Division: value.registarDivision.toUpperCase(),
                        Birth_Reg_No: value.birthRegNo,
                        Biometric_Data: value.bioData,
                        GovernmentID: value.GovernmentID,
                        downloadURL: value.downloadURL,
                        Father_Name: value.fatherName.toUpperCase(),
                        Mother_Name: value.motherName.toUpperCase(),
                        Prefix: value.prefix,
                        homeAddress: value.homeAddress.toUpperCase(),
                        officeAddress: value.officeAddress.toUpperCase(),
                        mobile: value.mobile,
                        landLine: value.landLine,
                        Email: value.email.toUpperCase(),
                        createdDateTime: new Date(),
                        status: &quot;Active&quot;,
                      })
                      .then(
                        async (res) &#x3D;&gt; {
                          resolve(res);
                          const eCitizen &#x3D; this.firestore
                            .collection(&quot;eCitizens&quot;)
                            .doc(value.GovernmentID);
                          await eCitizen.set(
                            {
                              uid: &quot;&quot; + user.uid,
                            },
                            { merge: true }
                          );
                          const citizenUpdate &#x3D; this.firestore
                            .collection(&quot;BirthRegistrations&quot;)
                            .doc(value.birthRegNo);
                          await citizenUpdate.set(
                            {
                              Registered: true,
                            },
                            { merge: true }
                          );
                        },
                        (err) &#x3D;&gt; reject(err)
                      );
                  });
                  // console.log(&quot;eCitizen Registered&quot;);
                  /**
                   * Once verifed registration takes place and informs applicant about the process by toast messages
                   * If registration is successful user will be redirect to login page
                   */
                  const toast &#x3D; await this.toastController.create({
                    message: &quot;Registration successful ✅&quot;,
                    duration: 2000,
                  });
                  toast.present();
                  let user &#x3D; firebase.default.auth().currentUser;
                  let date &#x3D; dateFormat(new Date(), &quot;mm-dd-yyyy&quot;);
                  const eAdministration &#x3D; this.firestore
                    .collection(&quot;eAdministration&quot;)
                    .doc(&quot;eServices&quot;)
                    .collection(&quot;SystemLogs&quot;)
                    .doc(date);
                  await eAdministration.set(
                    {
                      Account: firebase.default.firestore.FieldValue.arrayUnion(
                        &quot;web eCitizen registered&quot; +
                          user.email +
                          &quot; at: &quot; +
                          new Date()
                      ),
                    },
                    { merge: true }
                  );
                  this.route.navigate([&quot;sign-in&quot;]);
                });
              } else {
                /**
                 * Informs applicant that the details dont&#x27;t match with record
                 */
                // console.log(&quot;BIRTH REGISTRATION NOT MATCH!&quot;);
                const alert &#x3D; await this.alertController.create({
                  header: &quot;Registration Failed&quot;,
                  subHeader: &quot;BIRTH REGISTRATION DATA MISMATCH&quot;,
                  message:
                    &quot;Your registration has failed, as the entered details does not your match records.&quot;,
                  buttons: [&quot;Retry&quot;],
                });
                await alert.present();
              }
            }
          } else {
            /**
             * Informs applicant that the Birth Registration number is invalid to proceed further
             * This logic condition is set to prevent malicous access to system and it&#x27;s resources
             */
            // console.log(&quot;INVALID BIRTH REGISTRATION NO.&quot;);
            const alert &#x3D; await this.alertController.create({
              header: &quot;⚠ Registration Failed&quot;,
              subHeader: &quot;INVALID BIRTH REGISTRATION NO.&quot;,
              message:
                &quot;Your registration has failed, as the entered details are not valid.&quot;,
              buttons: [&quot;Retry&quot;],
            });
            await alert.present();
          }
        });
    });
  }

  /**
   * Method reponsible for sending NIC applications via Government Portal
   * To prevent third party usage of Government Resources secondary validation takes place to validate entered data before submitting application
   * This restricts that only the personal account holder to apply / Any form of Joint/Enterprise/Partner accounts are available at this time
   *
   * @param value This holds NIC application data send by registered user via forms available on the Account Portal
   *
   */
  async sendNICApplication(value, token) {
    return new Promise&lt;any&gt;(async (_resolve, _reject) &#x3D;&gt; {
      this.firestore
        .collection(&quot;BirthRegistrations&quot;)
        .doc(&quot;&quot; + value.birthCertNo + &quot;&quot;)
        .ref.get()
        .then(async (doc) &#x3D;&gt; {
          // console.log(doc.data());
          if (doc.exists) {
            let dateBirth &#x3D; dateFormat(value.dateOfBirth, &quot;mm/dd/yyyy&quot;);
            // console.log(value);
            if (
              doc.data()[&quot;birthRegNo&quot;] &#x3D;&#x3D; value.birthCertNo &amp;&amp;
              doc.data()[&quot;gender&quot;] &#x3D;&#x3D; value.gender.toUpperCase() &amp;&amp;
              doc.data()[&quot;dateOfBirth&quot;] &#x3D;&#x3D; dateBirth
            ) {
              return new Promise&lt;any&gt;(async (resolve, reject) &#x3D;&gt; {
                let user &#x3D; firebase.default.auth().currentUser;
                let date &#x3D; dateFormat(new Date(), &quot;mm-dd-yyyy&quot;);
                const eAdministration &#x3D; this.firestore
                  .collection(&quot;eAdministration&quot;)
                  .doc(&quot;eServices&quot;)
                  .collection(&quot;SystemLogs&quot;)
                  .doc(date);
                await eAdministration.set(
                  {
                    Login: firebase.default.firestore.FieldValue.arrayUnion(
                      &quot;web NIC application attempt from &quot; +
                        user.email +
                        &quot; at: &quot; +
                        new Date()
                    ),
                  },
                  { merge: true }
                );
                this.firestore
                  .collection(&quot;/eApplications/&quot;)
                  .doc(token)
                  .set({
                    GovernmentID: user.displayName,
                    token: token,
                    type: &quot;NIC-Application&quot;,
                    status: &quot;New&quot;,
                    payment_status: &quot;unpaid&quot;,
                    description: &quot;Application sent for Department&quot;,
                    email: value.email,
                    familyName: value.familyName,
                    name: value.name,
                    surname: value.surname,
                    engFamilyName: value.engFamilyName,
                    engName: value.engName,
                    engSurname: value.engSurname,
                    nicFamilyName: value.nicFamilyName,
                    nicName: value.nicName,
                    nicSurname: value.nicSurname,
                    gender: value.gender,
                    civilStatus: value.civilStatus,
                    profession: value.profession,
                    dateOfBirth: dateBirth,
                    birthCertNo: value.birthCertNo,
                    placeOfBirth: value.placeOfBirth,
                    division: value.division,
                    district: value.district,
                    birthRegNo: value.birthRegNo,
                    countryOfBirth: value.countryOfBirth,
                    foreignCertNo: value.foreignCertNo,
                    city: value.city,
                    houseNo: value.houseNo,
                    houseName: value.houseName,
                    streetName: value.streetName,
                    postalcode: value.postalcode,
                    postcity: value.postcity,
                    posthouseNo: value.posthouseNo,
                    posthouseName: value.posthouseName,
                    poststreetName: value.poststreetName,
                    postpostalcode: value.postpostalcode,
                    certDate: dateFormat(value.certDate, &quot;mm/dd/yyyy&quot;),
                    cardNo: value.cardNo,
                    nicDate: dateFormat(value.nicDate, &quot;mm/dd/yyyy&quot;),
                    policeName: value.policeName,
                    policeReportDate: dateFormat(
                      value.policeReportDate,
                      &quot;mm/dd/yyyy&quot;
                    ),
                    homePhone: value.homePhone,
                    mobilePhone: value.mobilePhone,
                    requestType: value.NICType,
                    sentTimeStamp: &quot;&quot; + new Date(),
                    processedTimeStamp: &quot;&quot;,
                    approvedTimeStamp: &quot;&quot;,
                  })
                  .then(
                    (response) &#x3D;&gt; resolve(response),
                    (error) &#x3D;&gt; reject(error)
                  );
              });
            } else {
              /**
               * Informs applicant that the details dont&#x27;t match with records to proceed further
               */
              const alert &#x3D; await this.alertController.create({
                header: &quot;⚠ Application Not Sent&quot;,
                subHeader: &quot;Registration Details !&quot;,
                message:
                  &quot;Your application has not been sent, as the entered details does not your match records.&quot;,
                buttons: [&quot;Retry&quot;],
              });
              await alert.present();
            }
          } else {
            /**
             * Informs applicant that the Birth Registration number is invalid to proceed further
             * This logic condition is set to prevent malicous use of system for unauthorised businesses
             */
            // console.log(&quot;BIRTH REGISTRATION NUMBER NOT FOUND!&quot;);
            const alert &#x3D; await this.alertController.create({
              header: &quot;⚠ Application Not Sent !&quot;,
              subHeader: &quot;Birth Registration&quot;,
              message:
                &quot;Your application has not been sent, as your details does not match any records.&quot;,
              buttons: [&quot;Close&quot;],
            });
            await alert.present();
          }
        });
    });
  }
  /**
   * Method reponsible for sending Support messages via Government Portal
   *
   * @param value This holds Support message data send by registered user via forms available on the Account Portal
   *
   */
  sendSupportMessage(value, name) {
    return new Promise&lt;any&gt;(async (_resolve, _reject) &#x3D;&gt; {
      return new Promise&lt;any&gt;(async (resolve, reject) &#x3D;&gt; {
        /**
         * Data gets stored on firebase, used for message tracking and references
         */
        const alert &#x3D; await this.alertController.create({
          header: &quot;✅ Support Requested&quot;,
          subHeader: &quot;Message Sent&quot;,
          message:
            &quot;Your message has been sent, wait for a reponse from support.&quot;,
          buttons: [&quot;OK&quot;],
        });
        await alert.present();
        let user &#x3D; firebase.default.auth().currentUser;
        let date &#x3D; dateFormat(new Date(), &quot;mm-dd-yyyy&quot;);
        const eAdministration &#x3D; this.firestore
          .collection(&quot;eAdministration&quot;)
          .doc(&quot;eServices&quot;)
          .collection(&quot;SystemLogs&quot;)
          .doc(date);
        await eAdministration.set(
          {
            Login: firebase.default.firestore.FieldValue.arrayUnion(
              &quot;web support message from&quot; + user.email + &quot; at: &quot; + new Date()
            ),
          },
          { merge: true }
        );
        this.firestore
          .collection(&quot;/eSupport/&quot;)
          .doc()
          .set({
            Description: value.message,
            FullName: name,
            GovernmentID: user.displayName,
            Status: &quot;New&quot;,
            Type: &quot;eCitizen&quot;,
            Subject: value.subject,
            Response: &quot;Message Sent | Wait for Response&quot;,
          })
          .then(
            (response) &#x3D;&gt; resolve(response),
            (error) &#x3D;&gt; reject(error)
          );
      });
    });
  }
  getESupportMessages() {
    let user &#x3D; firebase.default.auth().currentUser;

    return this.firestore
      .collection(&quot;eSupport&quot;, (ref) &#x3D;&gt;
        ref.where(&quot;GovernmentID&quot;, &quot;&#x3D;&#x3D;&quot;, user.displayName)
      )
      .snapshotChanges();
  }

  getEApplications() {
    let user &#x3D; firebase.default.auth().currentUser;
    return this.firestore
      .collection(&quot;eApplications&quot;, (ref) &#x3D;&gt;
        ref.where(&quot;GovernmentID&quot;, &quot;&#x3D;&#x3D;&quot;, user.displayName)
      )
      .snapshotChanges();
  }
  /**
   * Method for logging in user to system
   * @param value Holds data coming from Login form and invokes for verfication before allowing access
   */
  loginCitizen(value) {
    return new Promise&lt;any&gt;(async (resolve, reject) &#x3D;&gt; {
      const email &#x3D; value.email.toLowerCase();
      const address &#x3D; email.split(&quot;@&quot;).pop();
      if (
        address &#x3D;&#x3D; &quot;homeaffairs.gov.lk&quot; ||
        address &#x3D;&#x3D; &quot;admin.gov.lk&quot; ||
        address &#x3D;&#x3D; &quot;kiosk.gov.lk&quot; ||
        address &#x3D;&#x3D; &quot;gov.lk&quot;
      ) {
        const alert &#x3D; await this.alertController.create({
          header: &quot;⚠ Unauthorized Access&quot;,
          message: &quot;Login attempt failed, no record of eCitizen found.&quot;,
          buttons: [&quot;Close&quot;],
        });
        await alert.present();
        let user &#x3D; firebase.default.auth().currentUser;
        let date &#x3D; dateFormat(new Date(), &quot;mm-dd-yyyy&quot;);
        const eAdministration &#x3D; this.firestore
          .collection(&quot;eAdministration&quot;)
          .doc(&quot;eServices&quot;)
          .collection(&quot;SystemLogs&quot;)
          .doc(date);
        await eAdministration.set(
          {
            Login: firebase.default.firestore.FieldValue.arrayUnion(
              &quot;web failed login attempt from &quot; +
                value.email +
                &quot; at: &quot; +
                new Date()
            ),
          },
          { merge: true }
        );
      } else {
        this.gAuth.signInWithEmailAndPassword(value.email, value.password).then(
          (res) &#x3D;&gt; resolve(res),
          (err) &#x3D;&gt; reject(err)
        );
      }
    });
  }

  /**
   * On user command initiates Firebase signout, this method is accessible by all accounts for users, officers and administrators
   */
  logoutCitizen() {
    return new Promise&lt;void&gt;((resolve, reject) &#x3D;&gt; {
      let user &#x3D; firebase.default.auth().currentUser;
      let date &#x3D; dateFormat(new Date(), &quot;mm-dd-yyyy&quot;);
      if (this.gAuth.currentUser) {
        this.gAuth
          .signOut()
          .then(async () &#x3D;&gt; {
            const eAdministration &#x3D; this.firestore
              .collection(&quot;eAdministration&quot;)
              .doc(&quot;eServices&quot;)
              .collection(&quot;SystemLogs&quot;)
              .doc(date);
            await eAdministration.set(
              {
                Login: firebase.default.firestore.FieldValue.arrayUnion(
                  &quot;web logout attempt from &quot; + user.email + &quot; at: &quot; + new Date()
                ),
              },
              { merge: true }
            );
            // console.log(&quot;Signing out&quot;);
            resolve();
          })
          .catch((_error) &#x3D;&gt; {
            reject();
          });
      }
    });
  }

  /**
   * Method used for fetching current active user data from firebase these include email, photo, name of the authenticated user
   * Used for displaying data at required functions
   */
  eCitizenData() {
    return this.gAuth.user;
  }
}
</code></pre>
    </div>

</div>







                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'GoogleAuthService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
